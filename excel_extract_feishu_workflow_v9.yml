app:
  description: å½“ç”¨æˆ·ä¸Šä¼ Excelæ–‡ä»¶æ—¶ï¼Œè°ƒç”¨å¤–éƒ¨APIæœåŠ¡æå–æ•°æ®ï¼Œé€šè¿‡é£ä¹¦å‘é€ç»™æŒ‡å®šç”¨æˆ·ã€‚
  icon: "\U0001F4CA"
  icon_background: "#E4FBCC"
  mode: workflow
  name: Excelæ•°æ®æå–ä¸é£ä¹¦å‘é€
  use_icon_as_answer_icon: false
kind: app
version: 0.1.2
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      enabled: true
      allowed_file_types:
      - document
      allowed_file_extensions:
      - ".xls"
      - ".xlsx"
      allowed_file_upload_methods:
      - local_file
      - remote_url
      number_limits: 1
    opening_statement: ""
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ""
      voice: ""
  graph:
    edges:
    - data:
        isInIteration: false
        sourceType: start
        targetType: code
      id: start-download
      source: "1734355200000"
      sourceHandle: source
      target: "1734355200006"
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: code
        targetType: http-request
      id: download-extract
      source: "1734355200006"
      sourceHandle: source
      target: "1734355200001"
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: http-request
        targetType: if-else
      id: extract-check
      source: "1734355200001"
      sourceHandle: source
      target: "1734355200002"
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: http-request
      id: check-send
      source: "1734355200002"
      sourceHandle: "true"
      target: "1734355200003"
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: end
      id: check-fail
      source: "1734355200002"
      sourceHandle: "false"
      target: "1734355200005"
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: http-request
        targetType: end
      id: send-end
      source: "1734355200003"
      sourceHandle: source
      target: "1734355200004"
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: å·¥ä½œæµå¼€å§‹ï¼Œæ¥æ”¶ç”¨æˆ·ä¸Šä¼ çš„Excelæ–‡ä»¶
        selected: false
        title: å¼€å§‹
        type: start
        variables:
        - allowed_file_extensions:
          - ".xls"
          - ".xlsx"
          allowed_file_types:
          - document
          allowed_file_upload_methods:
          - local_file
          - remote_url
          label: Excelæ–‡ä»¶
          max_length: 48
          options: []
          required: true
          type: file
          variable: excel_file
        - label: é£ä¹¦Webhookåœ°å€
          max_length: 500
          options: []
          required: false
          type: text-input
          variable: webhook_url
        - label: Excelå¤„ç†æœåŠ¡åœ°å€
          max_length: 200
          options: []
          required: false
          type: text-input
          variable: api_url
          default: "http://host.docker.internal:8100"
      height: 118
      id: "1734355200000"
      position:
        x: 80
        y: 282
      positionAbsolute:
        x: 80
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: |
          import requests
          import base64

          def main(file_url: str) -> dict:
              """
              ä¸‹è½½æ–‡ä»¶å¹¶è½¬æ¢ä¸ºbase64
              ä½¿ç”¨Dify Sandboxæ”¯æŒçš„requestsåº“
              """
              try:
                  if not file_url:
                      return {
                          "success": "False",
                          "file_base64": "",
                          "message": "æ–‡ä»¶URLä¸ºç©º"
                      }
                  
                  # ä¸‹è½½æ–‡ä»¶
                  response = requests.get(file_url, timeout=60)
                  if response.status_code != 200:
                      return {
                          "success": "False",
                          "file_base64": "",
                          "message": f"ä¸‹è½½å¤±è´¥: HTTP {response.status_code}"
                      }
                  
                  # è½¬æ¢ä¸ºbase64
                  file_base64 = base64.b64encode(response.content).decode('utf-8')
                  
                  return {
                      "success": "True",
                      "file_base64": file_base64,
                      "message": f"æ–‡ä»¶ä¸‹è½½æˆåŠŸ, å¤§å°: {len(response.content)} å­—èŠ‚"
                  }
                  
              except Exception as e:
                  return {
                      "success": "False",
                      "file_base64": "",
                      "message": f"ä¸‹è½½æ–‡ä»¶å¤±è´¥: {str(e)}"
                  }
        code_language: python3
        desc: ä¸‹è½½æ–‡ä»¶å¹¶è½¬æ¢ä¸ºbase64
        outputs:
          success:
            children: null
            type: string
          file_base64:
            children: null
            type: string
          message:
            children: null
            type: string
        selected: false
        title: ä¸‹è½½æ–‡ä»¶
        type: code
        variables:
        - value_selector:
          - "1734355200000"
          - excel_file
          - url
          variable: file_url
      height: 54
      id: "1734355200006"
      position:
        x: 384
        y: 282
      positionAbsolute:
        x: 384
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        authorization:
          type: no-auth
          config: null
        body:
          type: json
          data: |
            {
              "file_base64": "{{#1734355200006.file_base64#}}"
            }
        desc: è°ƒç”¨å¤–éƒ¨FastAPIæœåŠ¡æå–Excelæ•°æ®
        headers: "Content-Type: application/json"
        params: ""
        method: post
        selected: false
        timeout:
          connect: 30
          read: 120
          write: 30
        title: è°ƒç”¨Excelæå–API
        type: http-request
        url: "{{#1734355200000.api_url#}}/extract"
      height: 54
      id: "1734355200001"
      position:
        x: 688
        y: 282
      positionAbsolute:
        x: 688
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: "true"
          conditions:
          - comparison_operator: is
            id: cond1
            value: "true"
            varType: string
            variable_selector:
            - "1734355200001"
            - body
            - success
          id: case_true
          logical_operator: and
        desc: æ£€æŸ¥APIè°ƒç”¨æ˜¯å¦æˆåŠŸ
        selected: false
        title: æ£€æŸ¥æå–ç»“æœ
        type: if-else
      height: 126
      id: "1734355200002"
      position:
        x: 992
        y: 282
      positionAbsolute:
        x: 992
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        authorization:
          type: no-auth
          config: null
        body:
          type: json
          data: |-
            {
              "msg_type": "interactive",
              "card": {
                "config": {"wide_screen_mode": true},
                "header": {
                  "title": {"tag": "plain_text", "content": "ğŸ“Š Excelæ•°æ®æå–å®Œæˆ"},
                  "template": "green"
                },
                "elements": [
                  {
                    "tag": "div",
                    "text": {
                      "tag": "lark_md",
                      "content": "**æå–ç»“æœï¼š**\n- æ ¼å¼ç±»å‹ï¼š{{#1734355200001.body.format_type#}}\n- æå–è¡Œæ•°ï¼š{{#1734355200001.body.row_count#}} è¡Œ\n- æ–‡ä»¶åï¼š{{#1734355200001.body.filename#}}"
                    }
                  },
                  {"tag": "hr"},
                  {
                    "tag": "note",
                    "elements": [{"tag": "plain_text", "content": "{{#1734355200001.body.message#}}"}]
                  }
                ]
              }
            }
        desc: å‘é€é£ä¹¦æ¶ˆæ¯é€šçŸ¥
        headers: "Content-Type: application/json"
        params: ""
        method: post
        selected: false
        timeout:
          connect: 10
          read: 60
          write: 20
        title: å‘é€é£ä¹¦æ¶ˆæ¯
        type: http-request
        url: "{{#1734355200000.webhook_url#}}"
      height: 54
      id: "1734355200003"
      position:
        x: 1296
        y: 232
      positionAbsolute:
        x: 1296
        y: 232
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: å¤„ç†æˆåŠŸç»“æŸ
        outputs:
        - value_selector:
          - "1734355200001"
          - body
          - success
          variable: success
        - value_selector:
          - "1734355200001"
          - body
          - format_type
          variable: format_type
        - value_selector:
          - "1734355200001"
          - body
          - row_count
          variable: row_count
        - value_selector:
          - "1734355200001"
          - body
          - filename
          variable: filename
        - value_selector:
          - "1734355200001"
          - body
          - message
          variable: message
        - value_selector:
          - "1734355200001"
          - body
          - file_base64
          variable: file_base64
        selected: false
        title: æˆåŠŸç»“æŸ
        type: end
      height: 90
      id: "1734355200004"
      position:
        x: 1600
        y: 232
      positionAbsolute:
        x: 1600
        y: 232
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: å¤„ç†å¤±è´¥ç»“æŸ
        outputs:
        - value_selector:
          - "1734355200001"
          - body
          - success
          variable: success
        - value_selector:
          - "1734355200001"
          - body
          - message
          variable: error_message
        selected: false
        title: å¤±è´¥ç»“æŸ
        type: end
      height: 90
      id: "1734355200005"
      position:
        x: 1296
        y: 382
      positionAbsolute:
        x: 1296
        y: 382
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
  hash: ""
